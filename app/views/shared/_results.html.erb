
<%# PENDANT LE TEST AVEC LE SEED J'AI DU METTRE DES STRINGS AU LIEU DE SYMBOLES %>


<div class = "container mt-3">
  <h1>Votre selection de voyages </h1>

  <%# c'est la vignette fake pour la démo : %>
  <%# ============================= %>
   <div class="grande-card p-3">
     <div id="first-card" class ="p-3 mt-4" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://images.unsplash.com/photo-1529260830199-42c24126f198?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1355&q=80');">
            <%=link_to group_tickets_path do%>
            <h4>ROME</h4>
            <p>Italie</p>
            <p id="destination"><i class="fas fa-star"></i> <em>Notre meilleure selection</em></p>
            <p id="prix-voyage"> 170 €/personne </p>
            <p id="info"> Choisir cette destination</p>
          </div>
        <% end %> 
  </div> 

  <%# =============================  %>
    
    <%# trier par prix pas besoin car déjà fait sur l'api : %>
    <%# ========================= %>
      <%# for city in @cities
        for traveler in @travelers
              @trips[traveler][city][0].sort_by { |aller| aller[:price] }
            end
        end %>
        <%# ===================== %>


 <div class="cards p-3 mt-1">
    <% for @city in @group.cities %>

        <%# test scraping images from cities %>
<% require 'i18n'%>
<% require 'open-uri' %>
<% require 'nokogiri' %>
<% city_name = I18n.transliterate(@city) %>
<% url = "https://unsplash.com/s/photos/#{city_name}"%>

<% html_file = open(url).read %>
<%html_doc = Nokogiri::HTML(html_file) %>

<% element = html_doc.search('._2UpQX').first %>
<% element.text.strip %>
<% image_city = element.attribute('src').value %> 
      <%# test scraping images from cities %>
      <%= link_to group_tickets_path, class: "clickable-card" do %>
        <div class="card-category p-3" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('<%=image_city%>');">
            <div class="card_recto">
              <%= render "shared/recto" %>
            </div>
            <%# <div class="card_verso">
              <%= render "shared/verso" %>
            <%# </div> %> 
        </div>
      <% end %>
    <% end %>
  </div>
</div>


<%# INUTILE A SUPPRIMER %>
<%# <script type="text/javascript">
clik = document.querySelector(".card_recto")

clik.addEventListener("click", () => { 

 clik.classList.toggle("flipped");
})
</script> %>


<div class = "container">
  <% for city in @group.cities %>

    <h1 style="color: red">VOYAGE EN DIRECTION DE : <%= city %></h1>

    <% for traveler in @travelers %>

        <h1>Proposition pour <%= traveler[:name] %></h1>

        <div class ="d-flex justify-content-between">
            <div>
            <h2>ALLER</h2>
                <ul><h3>Départ</h3>
                <li> Ville de départ : <%= @trips[traveler][city][0].first[:cityFrom] %></li>
                <li> Date de départ :  <%= Time.at(@trips[traveler][city][0].first[:dTime]).strftime("%A %d %B %G") %> </li>
                <li> Heure de départ : <%= Time.at(@trips[traveler][city][0].first[:dTime]).strftime("%H:%M")%></li>
                </ul>
            <ul><h3>Arrivée</h3>
                <li> Ville d'arrivée : <%= @trips[traveler][city][0].first[:cityTo] %></li>
                <li> Date d'arrivée : <%= Time.at(@trips[traveler][city][0].first[:aTime]).strftime("%d/%m/%Y") %></li>
                <li> Heure d'arrivée : <%= Time.at(@trips[traveler][city][0].first[:aTime]).strftime("%H:%M")%></li>
                </ul>
            </div>

            <div>
            <h2>RETOUR</h2>
                <ul><h3>Départ</h3>
                <li> Ville de départ : <%= @trips[traveler][city][1].first[:cityFrom] %></li>
                <li> Date de départ : <%= Time.at(@trips[traveler][city][1].first[:dTime]).strftime("%d/%m/%Y") %> </li>
                <li> Heure de départ : <%= Time.at(@trips[traveler][city][1].first[:dTime]).strftime("%H:%M")%></li>
                </ul>

            <ul><h3>Arrivée</h3>
                <li> Ville d'arrivée : <%= @trips[traveler][city][1].first[:cityTo] %></li>
                <li> Date d'arrivée : <%= Time.at(@trips[traveler][city][1].first[:aTime]).strftime("%d/%m/%Y") %></li>
                <li> Heure d'arrivée : <%= Time.at(@trips[traveler][city][1].first[:aTime]).strftime("%H:%M")%></li>
            </ul>
            </div>
        </div>
            <div>
            <ul>
            <div class="group-btn float-right">
                <%= link_to "Selectionner cette destination", :controller => "groups", :action => "tickets", :query => "#{city}" %>
            </div>

                <h3>Détails</h3>
                <li> Prix aller : <%= @trips[traveler][city][0].first[:price] %></li>
                <li> Lien : <a href="<%= @trips[traveler][city][0].first[:url] %>">Réserver sur kiwi</a></li>
                <li> Prix retour : <%= @trips[traveler][city][1].first[:price] %></li>
                <li> Lien : <a href="<%= @trips[traveler][city][1].first[:url] %>">Réserver sur kiwi</a></li>
                <li style = "color: lime"> Prix total : <%= @trips[traveler][city][0].first[:price] + @trips[traveler][city][1].first[:price] %></li>
                <!--  <li> Code de la compagnie aérienne aller : <%= @trips[traveler][city][0].first[:airlines] %></li>
                <li> Code de la compagnie aérienne retour : <%= @trips[traveler][city][1].first[:airlines] %></li>
                <li> Coordonnées de l'aéroport de <%= @trips[traveler][city][0].first[:cityFrom]  %>  : <%= @trips[traveler][city][0].first[:latFrom] %> / <%= @trips[traveler][city][0].first[:lngFrom] %></li>
                <li> Coordonnées de l'aéroport de <%= @trips[traveler][city][0].first[:cityTo]  %> : <%= @trips[traveler][city][0].first[:latTo] %> / <%= @trips[traveler][city][0].first[:lngTo] %></li>
                <li> Coordonnées de l'aéroport de <%= @trips[traveler][city][1].first[:cityFrom]  %>  : <%= @trips[traveler][city][1].first[:latFrom] %> / <%= @trips[traveler][city][1].first[:lngFrom] %></li>
                <li> Coordonnées de l'aéroport de <%= @trips[traveler][city][1].first[:cityTo]  %> : <%= @trips[traveler][city][1].first[:latTo] %> / <%= @trips[traveler][city][1].first[:lngTo] %></li> -->
            </ul>
            </div>

    <% end %>
  <% end %>
</div>
