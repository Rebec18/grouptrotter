<h1> Nos recherches </h1>


Il faut comparer les résultats de chaque voyageurs pour ne prendre que les villes communes à tous les voyageurs
Test constitution array des villes du premier voyageur:
<% array_cities_first = [] %>
<% @big_hash[@group.travelers.first.id][0].each do |element| %>
  <% array_cities_first << element["cityTo"] %>
<% end %>
<%= array_cities_first %>

Test array villes 2eme voyageur:
<% array_cities_second = [] %>
<% @big_hash[@group.travelers[1].id][0].each do |element| %>
  <% array_cities_second << element["cityTo"] %>
<% end %>
<% common_cities = array_cities_second.select { |city| array_cities_first.include?(city)} %>

Là j'obtient un array de toutes les villes communes aux 2 voyageurs
<% @big_hash.each_key do |voyageur| %>
  <% @big_hash[voyageur][0].select! { |mini_hash| common_cities.include?(mini_hash["cityTo"]) } %>
<% end %>
s

TEST TEST TEST ====
voici common_cities :
<%= @common_cities %>

=====

<% raise %>

<% @big_hash.each do |key, value| %>

  <h1>Proposition pour <%= Traveler.find(id = key).name %></h1>
  <% count = 0 %>
  <% while count < value[0].count %>
  <h2>ALLER</h2>
    <ul><h3>Départ</h3>
      <li> Ville de départ : <%= value[0][count]["cityFrom"] %></li>
      <li> Date de départ : <%= Time.at(value[0][count]["dTime"]).strftime("%d/%m/%Y") %> </li>
      <li> Heure de départ : <%= Time.at(value[0][count]["dTime"]).strftime("%H:%M")%></li>
    </ul>
  <ul><h3>Arrivée</h3>
      <li> Ville d'arrivée : <%= value[0][count]["cityTo"] %></li>
      <li> Date d'arrivée : <%= Time.at(value[0][count]["aTime"]).strftime("%d/%m/%Y") %></li>
      <li> Heure d'arrivée : <%= Time.at(value[0][count]["aTime"]).strftime("%H:%M")%></li>
    </ul>

<%# <% city = value[0][count]["cityTo"] %> 

  <h2>RETOUR</h2>

    <%# value[1]

  récupère l'array des retour depuis city
  on prend le moins cher
  on affiche les données de ce ticket %>

    <ul><h3>Départ</h3>
      <li> Ville de départ : <%= value[1][count]["cityFrom"] %></li>
      <li> Date de départ : <%= Time.at(value[1][count]["dTime"]).strftime("%d/%m/%Y") %></li>
      <li> Heure de départ : <%= Time.at(value[1][count]["dTime"]).strftime("%H:%M")%></li>
      </ul>

  <ul><h3>Arrivée</h3>
      <li> Ville d'arrivée : <%= value[1][count]["cityTo"] %></li>
      <li> Date d'arrivée : <%= Time.at(value[1][count]["aTime"]).strftime("%d/%m/%Y") %> </li>
      <li> Heure d'arrivée : <%= Time.at(value[1][count]["aTime"]).strftime("%H:%M")%></li>
  </ul>
  <ul>
    <h3>Détails</h3>
      <li> Prix aller : <%= value[0][count]["price"] %></li>
      <li> Prix retour : <%= value[1][count]["price"] %></li>
      <li> Prix sa mèèèère : <%= value[0][count]["price"] + value[1][count]["price"] %></li>
      <li> Code de la compagnie aérienne aller : <%= value[0][count]["airlines"] %></li>
      <li> Code de la compagnie aérienne retour : <%= value[1][count]["airlines"] %></li>
      <li> Coordonnées de l'aéroport de <%= value[0][count]["cityFrom"]  %>  : <%= value[0][count]["latFrom"] %> / <%= value[0][count]["lngFrom"] %></li>
      <li> Coordonnées de l'aéroport de <%= value[0][count]["cityTo"]  %> : <%= value[0][count]["latTo"] %> / <%= value[0][count]["lngTo"] %></li>
      <li> Coordonnées de l'aéroport de <%= value[1][count]["cityFrom"]  %>  : <%= value[1][count]["latFrom"] %> / <%= value[1][count]["lngFrom"] %></li>
      <li> Coordonnées de l'aéroport de <%= value[1][count]["cityTo"]  %> : <%= value[1][count]["latTo"] %> / <%= value[1][count]["lngTo"] %></li>
  </ul>
  <% count += 1 %>








    <!-- on ajoute un bouton pour aller sur la page tickets -->
    <div class="group-btn float-right">
<%# FAUDRA METTRE DANS LA CARD AVEC LA BONNE CITYTO %>
      <%# <%= link_to "Selectionner cette destination", :controller => "groups", :action => "tickets", :query => "#{value[0][count]["cityTo"]}" %> %>
    </div>

  <% end %>
<% end %>